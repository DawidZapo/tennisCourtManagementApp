<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Rezerwacje kortów</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://kit.fontawesome.com/30a7deb79a.js" crossorigin="anonymous"></script>
    <style></style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-primary bg-light navbar-custom">
    <div class="col-md-4 d-flex flex-wrap align-items-center">
        <a class="navbar-brand" style="padding-left: 15px" th:href="@{/}">
            <img width="60" height="100" src="/images/mzuk.png" alt="Logo">
        </a>

        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" th:href="@{/courts}">Korty</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/daySummary}">Roliczenie</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/settings}">Ustawienia</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/settings}">Pomoc</a>
            </li>
        </ul>
    </div>
    <div class="col-md-4 d-flex flex-wrap align-items-center">
        <div class="navbar-text mx-auto">
            <a th:href="@{/}" class="text-decoration-none">
                <h1 id="current-date-time" class="display-4"></h1>
            </a>
        </div>
    </div>
    <div class="col-md-4 d-flex flex-wrap justify-content-end align-items-center">
        <div class="user-info m-3">
            Zalogowany jako: <strong th:text="${username}"></strong>
        </div>

        <form class="mx-4" action="#" th:action="@{/logout}" method="POST">
            <button type="submit" value="Wyloguj się" class="btn btn-outline-danger">
                Wyloguj się
                <i class="fa-solid fa-right-from-bracket mx-2"></i>
            </button>
        </form>
    </div>


</nav>

<div class="container-fluid mt-2">
    <div class="row">
        <div class="col-md-2">
            <div class="nav flex-column nav-pills nav-pills-vertical" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <a class="nav-link active" id="courtReservationsTab" data-toggle="pill" href="#courtReservations" role="tab" aria-controls="courtReservations" aria-selected="true">Rezerwacje kortów</a>
                <a class="nav-link" id="courtPreviewTab" data-toggle="pill" href="#courtPreview" role="tab" aria-controls="courtPreview" aria-selected="false">Podgląd kortów</a>
                <a class="nav-link" id="upcomingReservationTab" data-toggle="pill" href="#upComingReservations" role="tab" aria-controls="upcomingReservations" aria-selected="false">Przyszłe rezerwacje</a>
                <a class="nav-link" id="customerHandlingTab" data-toggle="pill" href="#customerHandling" role="tab" aria-controls="customerHandling" aria-selected="false">Zarządzanie klientami</a>
            </div>
        </div>
        <div class="col-md-10">
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade show active" id="courtReservations" role="tabpanel" aria-labelledby="v-pills-home-tab">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12 d-flex justify-content-between align-items-center">
                                        <div class="d-flex flex-grow-1 align-items-center">
                                            <h2 class="mr-3 w-100 text-start" th:text="${dayOfWeek}+'  '+${formattedDate}"></h2>
                                        </div>
                                        <div class="d-flex flex-grow-1 align-items-center justify-content-center">
                                            <input type="date" id="date-picker" class="form-control mx-1 w-100" >
                                            <a class="btn btn-outline-primary mx-1 w-100" href="#morning">Rano</a>
                                            <a class="btn btn-outline-primary mx-1 w-100" href="#afternoon">Popołudnie</a>
                                            <a class="btn btn-outline-primary mx-1 w-100" href="#evening">Wieczór</a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>


                    <div class="table-container" style="overflow-y: auto; max-height: 70vh;">
                        <table id="reservationTable" class="table table-bordered table-striped">
                            <thead class="table-dark" style="position: sticky; top: -1px;z-index: 1; height: 50px">
                            <tr>
                                <th class="col-md-1 align-middle text-center">
                                    <div class="flex-fill w-100">
                                        <a id="addReservationBtn" class="btn btn-sm btn-success" style="display: none">Dodaj</a>
                                    </div>
                                </th>
                                <th class="align-middle text-center">Kort 1</th>
                                <th class="align-middle text-center">Kort 2</th>
                                <th class="align-middle text-center">Kort 3</th>
                                <th class="align-middle text-center">Kort 4</th>
                                <th class="align-middle text-center">Kort 5</th>
                            </tr>
                            </thead>
                            <tbody>
                                    <tr id="morning">
                                        <td>8:00</td>
                                        <td id="08:00court1"></td>
                                        <td id="08:00court2"></td>
                                        <td id="08:00court3"></td>
                                        <td id="08:00court4"></td>
                                        <td id="08:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>8:30</td>
                                        <td id="08:30court1"></td>
                                        <td id="08:30court2"></td>
                                        <td id="08:30court3"></td>
                                        <td id="08:30court4"></td>
                                        <td id="08:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>9:00</td>
                                        <td id="09:00court1"></td>
                                        <td id="09:00court2"></td>
                                        <td id="09:00court3"></td>
                                        <td id="09:00court4"></td>
                                        <td id="09:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>9:30</td>
                                        <td id="09:30court1"></td>
                                        <td id="09:30court2"></td>
                                        <td id="09:30court3"></td>
                                        <td id="09:30court4"></td>
                                        <td id="09:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>10:00</td>
                                        <td id="10:00court1"></td>
                                        <td id="10:00court2"></td>
                                        <td id="10:00court3"></td>
                                        <td id="10:00court4"></td>
                                        <td id="10:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>10:30</td>
                                        <td id="10:30court1"></td>
                                        <td id="10:30court2"></td>
                                        <td id="10:30court3"></td>
                                        <td id="10:30court4"></td>
                                        <td id="10:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>11:00</td>
                                        <td id="11:00court1"></td>
                                        <td id="11:00court2"></td>
                                        <td id="11:00court3"></td>
                                        <td id="11:00court4"></td>
                                        <td id="11:00court5"></td>
                                    </tr>
                                    <tr id="afternoon">
                                        <td>11:30</td>
                                        <td id="11:30court1"></td>
                                        <td id="11:30court2"></td>
                                        <td id="11:30court3"></td>
                                        <td id="11:30court4"></td>
                                        <td id="11:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>12:00</td>
                                        <td id="12:00court1"></td>
                                        <td id="12:00court2"></td>
                                        <td id="12:00court3"></td>
                                        <td id="12:00court4"></td>
                                        <td id="12:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>12:30</td>
                                        <td id="12:30court1"></td>
                                        <td id="12:30court2"></td>
                                        <td id="12:30court3"></td>
                                        <td id="12:30court4"></td>
                                        <td id="12:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>13:00</td>
                                        <td id="13:00court1"></td>
                                        <td id="13:00court2"></td>
                                        <td id="13:00court3"></td>
                                        <td id="13:00court4"></td>
                                        <td id="13:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>13:30</td>
                                        <td id="13:30court1"></td>
                                        <td id="13:30court2"></td>
                                        <td id="13:30court3"></td>
                                        <td id="13:30court4"></td>
                                        <td id="13:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>14:00</td>
                                        <td id="14:00court1"></td>
                                        <td id="14:00court2"></td>
                                        <td id="14:00court3"></td>
                                        <td id="14:00court4"></td>
                                        <td id="14:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>14:30</td>
                                        <td id="14:30court1"></td>
                                        <td id="14:30court2"></td>
                                        <td id="14:30court3"></td>
                                        <td id="14:30court4"></td>
                                        <td id="14:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>15:00</td>
                                        <td id="15:00court1"></td>
                                        <td id="15:00court2"></td>
                                        <td id="15:00court3"></td>
                                        <td id="15:00court4"></td>
                                        <td id="15:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>15:30</td>
                                        <td id="15:30court1"></td>
                                        <td id="15:30court2"></td>
                                        <td id="15:30court3"></td>
                                        <td id="15:30court4"></td>
                                        <td id="15:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>16:00</td>
                                        <td id="16:00court1"></td>
                                        <td id="16:00court2"></td>
                                        <td id="16:00court3"></td>
                                        <td id="16:00court4"></td>
                                        <td id="16:00court5"></td>
                                    </tr>
                                    <tr id="evening">
                                        <td>16:30</td>
                                        <td id="16:30court1"></td>
                                        <td id="16:30court2"></td>
                                        <td id="16:30court3"></td>
                                        <td id="16:30court4"></td>
                                        <td id="16:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>17:00</td>
                                        <td id="17:00court1"></td>
                                        <td id="17:00court2"></td>
                                        <td id="17:00court3"></td>
                                        <td id="17:00court4"></td>
                                        <td id="17:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>17:30</td>
                                        <td id="17:30court1"></td>
                                        <td id="17:30court2"></td>
                                        <td id="17:30court3"></td>
                                        <td id="17:30court4"></td>
                                        <td id="17:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>18:00</td>
                                        <td id="18:00court1"></td>
                                        <td id="18:00court2"></td>
                                        <td id="18:00court3"></td>
                                        <td id="18:00court4"></td>
                                        <td id="18:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>18:30</td>
                                        <td id="18:30court1"></td>
                                        <td id="18:30court2"></td>
                                        <td id="18:30court3"></td>
                                        <td id="18:30court4"></td>
                                        <td id="18:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>19:00</td>
                                        <td id="19:00court1"></td>
                                        <td id="19:00court2"></td>
                                        <td id="19:00court3"></td>
                                        <td id="19:00court4"></td>
                                        <td id="19:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>19:30</td>
                                        <td id="19:30court1"></td>
                                        <td id="19:30court2"></td>
                                        <td id="19:30court3"></td>
                                        <td id="19:30court4"></td>
                                        <td id="19:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>20:00</td>
                                        <td id="20:00court1"></td>
                                        <td id="20:00court2"></td>
                                        <td id="20:00court3"></td>
                                        <td id="20:00court4"></td>
                                        <td id="20:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>20:30</td>
                                        <td id="20:30court1"></td>
                                        <td id="20:30court2"></td>
                                        <td id="20:30court3"></td>
                                        <td id="20:30court4"></td>
                                        <td id="20:30court5"></td>
                                    </tr>
                                    <tr>
                                        <td>21:00</td>
                                        <td id="21:00court1"></td>
                                        <td id="21:00court2"></td>
                                        <td id="21:00court3"></td>
                                        <td id="21:00court4"></td>
                                        <td id="21:00court5"></td>
                                    </tr>
                                    <tr>
                                        <td>21:30</td>
                                        <td id="21:30court1"></td>
                                        <td id="21:30court2"></td>
                                        <td id="21:30court3"></td>
                                        <td id="21:30court4"></td>
                                        <td id="21:30court5"></td>
                                    </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="courtPreview" role="tabpanel" aria-labelledby="courtPreviewTab">
                    <h2>Podgląd kortów na żywo</h2>
                    <hr class="my-0">
                    <div class="container mt-3">
                        <div class="row">
                            <div th:each="court : ${courts}" class="col-md-4">
                                <div th:id="displayCourtCard + ${court.id}" class="card mb-4">
                                    <div th:classappend="${!court.active} ? 'card-header alert alert-danger my-alert' : 'card-header'">
                                        <h5 class="card-title text-center" th:text="Kort + ' ' + ${court.id}"></h5>
                                        <span th:if="${court.flooded}">
                                            <i class="fa fa-solid fa-cloud-showers-heavy my-court-card-right-icon"></i>
                                        </span>
                                        <span th:if="${!court.functional}">
                                            <i class="fa fa-solid fa-ban my-court-card-left-icon"></i>
                                        </span>
                                    </div>
                                    <a th:id="displayCourtCardBody+${court.id}" style="text-decoration: none;" th:classappend="${!court.active} ? 'card-body my-disabled' : 'card-body'">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <p class="mb-2"><strong>Status: </strong>wolny</p>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="upComingReservations" role="tabpanel" aria-labelledby="upcomingReservationTab">
                    <h2>Dzisiejsze przyszłe rezerwacje</h2>
                    <hr class="my-0">
                    <div class="container mt-3">
                        <div class="row">
                            <div th:each="court : ${courts}" class="col-md-4">
                                <div th:id="futureCourtCard + ${court.id}" class="card mb-4">
                                    <div th:classappend="${!court.active} ? 'card-header alert alert-danger my-alert' : 'card-header'">
                                        <h5 class="card-title text-center" th:text="Kort + ' ' + ${court.id}"></h5>
                                        <span th:if="${court.flooded}">
                                            <i class="fa fa-solid fa-cloud-showers-heavy my-court-card-right-icon"></i>
                                        </span>
                                        <span th:if="${!court.functional}">
                                            <i class="fa fa-solid fa-ban my-court-card-left-icon"></i>
                                        </span>
                                    </div>
                                    <div style="text-decoration: none;" th:classappend="${!court.active} ? 'card-body my-disabled' : 'card-body'">
                                        <div class="row">
                                            <div th:id="futureCourtCardBody+${court.id}" class="col-sm-12">
                                                <a style="text-decoration: none;">
                                                    <p class="mb-2" style="color: black !important;"><strong>Status: </strong>wolny hello</p>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="customerHandling" role="tabpanel" aria-labelledby="customerHandlingTab">
                    <h2>Zarządzaj klientami</h2>
                    <a th:href="@{/customer/showFormForAdd}" class="btn btn-success mt-2">Dodaj nowego klienta</a>

                    <hr class="my-3">
                    <input type="text" id="searchInput" oninput="searchCustomers()" class="form-control" placeholder="Wyszukaj klienta [nazwisko]">

                    <table id="customerTable" class="table mt-2">
                        <thead>
                        <tr>
                            <th class="text-center">Imię</th>
                            <th class="text-center">Nazwisko</th>
                            <th class="text-center">Telefon</th>
                            <th class="text-center">Akcja</th>
                        </tr>
                        </thead>
                        <tbody id="customerTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--<div class="navbar navbar-expand-lg navbar-light bg-primary bg-light fixed-bottom navbar-custom">-->
<!--        <p>-->
<!--            Przykładowy tekst paska dolnego-->
<!--        </p>-->
<!--</div>-->


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="/js/updateTime.js"></script>
<script src="/js/updateSelectedDate.js"></script>
<script src="/js/updateCurrentReservations.js"></script>
<script src="/js/updateUpcomingAndOngoingReservations.js"></script>
<script th:inline="javascript">
    // funkcja dodajace kafelki rezerwacji z db
    class Customer {
        constructor(id, firstName, lastName, phone) {
            this.id = id;
            this.firstName = firstName;
            this.lastName = lastName;
            this.phone = phone;
        }
    }

    class Court {
        constructor(id, courtNumber, active, functional, flooded) {
            this.id = id;
            this.courtNumber = courtNumber;
            this.active = active;
            this.functional = functional;
            this.flooded = flooded;
        }
    }

    class Reservation {
        constructor(id, courtNumber, reservationDate, timeStart, timeEnd, duration, priceSchedule, totalPrice, comments, reservationMadeTimestamp, paid, doublesMatch, customer, isCash, acceptedBy, acceptedAt, validForFinanceSummary) {
            this.id = id;
            this.courtNumber = courtNumber;
            this.reservationDate = reservationDate;
            this.timeStart = timeStart;
            this.timeEnd = timeEnd;
            this.duration = duration;
            this.priceSchedule = priceSchedule;
            this.totalPrice = totalPrice;
            this.comments = comments;
            this.reservationMadeTimestamp = reservationMadeTimestamp;
            this.paid = paid;
            this.doublesMatch = doublesMatch;
            this.customer = new Customer(
                customer.id,
                customer.firstName,
                customer.lastName,
                customer.phone
            );
            this.isCash = isCash;
            this.acceptedBy = acceptedBy;
            this.acceptedAt = acceptedAt;
            this.validForFinanceSummary = validForFinanceSummary;
        }
    }


    const reservations = /*[[${reservations}]]*/ [];

    function createReservationObjects() {
        const reservationObjects = [];

        reservations.forEach(function(reservation) {
            const customer = reservation.customer;
            const newCustomer = new Customer(
                customer.id,
                customer.firstName,
                customer.lastName,
                customer.phone
            );

            const newReservation = new Reservation(
                reservation.id,
                reservation.courtNumber,
                reservation.reservationDate,
                reservation.timeStart,
                reservation.timeEnd,
                reservation.duration,
                reservation.priceSchedule,
                reservation.totalPrice,
                reservation.comments,
                reservation.reservationMadeTimestamp,
                reservation.paid,
                reservation.doublesMatch,
                newCustomer,
                reservation.isCash,  // Dodaj isCash
                reservation.acceptedBy,  // Dodaj acceptedBy
                reservation.acceptedAt, // Dodaj acceptedAt
                reservation.validForFinanceSummary
            );

            reservationObjects.push(newReservation);
        });

        return reservationObjects;
    }


    let jsReservations = createReservationObjects();

    function fillUpTheTable(reservations,courts){
        reservations.forEach(reservation=>{
            const timeStartId = reservation.timeStart.slice(0,5)+'court'+reservation.courtNumber;
            const td = document.getElementById(timeStartId);
            const numberOfRowsToSpan = reservation.duration / 30;

            for (let i = 0; i < numberOfRowsToSpan; i++) {
                const [hours, minutes] = reservation.timeStart.split(':');
                const [year,month,day] = reservation.reservationDate.split('-');
                const timeStart = new Date(year, month, day, hours, minutes);

                const currentCellTime = new Date(timeStart.getTime() + (i * 30 * 60 * 1000));
                const currentCellId = `${currentCellTime.getHours().toString().padStart(2, '0')}:${currentCellTime.getMinutes().toString().padStart(2, '0')}court${reservation.courtNumber}`;
                const currentCell = document.getElementById(currentCellId);

                if(currentCell){
                    if (i === 0) {
                        currentCell.setAttribute('rowspan', numberOfRowsToSpan);
                    } else {
                        currentCell.remove();
                    }
                }
            }
            const tile = document.createElement('a');
            tile.classList.add('btn', 'btn-success', 'tile');
            tile.setAttribute('style', 'white-space: pre;');
            tile.textContent = reservation.customer.firstName+ ' ' + reservation.customer.lastName + '\r\n'
            + reservation.timeStart.slice(0,5) + ' - ' + reservation.timeEnd.slice(0,5);
            const reservationURL = `/reservation?id=${reservation.id}`;
            tile.setAttribute('href', reservationURL);


            // jesli kort zalany dodajemy wyszarzenie, sprawdzamy tez czy null bo jesli fetch bedzie z błedem to wywolujemy funkcje z null
            if(courts != null){
                if(courts[reservation.courtNumber-1].active === false){
                    tile.classList.add('my-disabled');
                }
            }


            if(!reservation.validForFinanceSummary){
                const icon = document.createElement('i');
                icon.classList.add('fa', 'fa-solid', 'fa-hand-holding-dollar', 'my-icon');
                tile.appendChild(icon);
            }
            else if (reservation.paid) {
                const icon = document.createElement('i');
                icon.classList.add('fa', 'fa-check', 'my-icon'); // Przykładowa ikona FontAwesome
                tile.appendChild(icon);
            }

            td.appendChild(tile);

        })
    }


    fetch('/api/courts')
        .then(response => response.json())
        .then(data => {
            const courts = data.map(courtData => {
                return new Court(
                    courtData.id,
                    courtData.courtNumber,
                    courtData.active,
                    courtData.functional,
                    courtData.flooded
                );
            });

            fillUpTheTable(jsReservations,courts);
        })
        .catch(error => {
            console.error('There was an error!', error); // Obsługa błędów
            fillUpTheTable(jsReservations,null);
        });


</script>
<script th:inline="javascript">
    //funkcja dodajaca mozliwosc zaznaczaia kafelek bez rezerwacji
    function countSelectedTiles() {
        return document.querySelectorAll('.clicked').length;
    }
    function getSelectedCells() {
        const selectedCells = [];
        const table = document.getElementById('reservationTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            for (let j = 1; j < cells.length; j++) { // Rozpocznij od 1, pomijając pierwszą kolumnę z godzinami
                const cell = cells[j];
                if (cell.classList.contains('clicked')) {
                    selectedCells.push(cell);
                }
            }
        }
        return selectedCells;
    }
    function fillRemainingSlots() {
        const addReservationBtn = document.getElementById('addReservationBtn');
        const table = document.getElementById('reservationTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            for (let j = 1; j < cells.length; j++) { // Rozpocznij od 1, pomijając pierwszą kolumnę z godzinami
                const cell = cells[j];
                if (cell.innerHTML.trim() === '') { // Sprawdź czy komórka jest pusta
                    cell.addEventListener('mouseover', function() {
                        if (!cell.classList.contains('clicked')) { // Zaznacz tylko jeśli nie jest już zaznaczona
                            cell.style.backgroundColor = '#dcffd8'; // Zmiana koloru w momencie najechania
                        }
                    });

                    cell.addEventListener('mouseout', function() {
                        if (!cell.classList.contains('clicked')) {
                            cell.style.backgroundColor = ''; // Usunięcie koloru po opuszczeniu komórki
                        }
                    });

                    cell.addEventListener('click', function() {
                        if (!cell.classList.contains('clicked')) {
                            cell.classList.add('clicked'); // Dodanie klasy po kliknięciu, oznaczającej, że komórka została zaznaczona
                            //cell.style.backgroundColor = 'orange'; // Zmiana koloru po kliknięciu
                            const tile = document.createElement('a');
                            tile.classList.add('btn', 'btn-success', 'tile');
                            tile.setAttribute('style', 'white-space: pre;');
                            cell.appendChild(tile);
                        } else {
                            cell.classList.remove('clicked'); // Usunięcie klasy i przywrócenie pierwotnego koloru po ponownym kliknięciu
                            //cell.style.backgroundColor = '';
                            const lastChild = cell.lastElementChild;
                            if(lastChild){
                                cell.removeChild(lastChild);
                            }
                        }
                        const selectedTiles = countSelectedTiles();
                        if (selectedTiles > 0) {
                            addReservationBtn.style.display = 'block';
                        } else {
                            addReservationBtn.style.display = 'none';
                        }
                    });
                }
            }
        }
    }

    fillRemainingSlots();




    document.getElementById('addReservationBtn').addEventListener('click', function() {
        const date = /*[[${date}]]*/ '';

        const selectedTiles = getSelectedCells();
        const selectedTilesData = selectedTiles.map(tile => tile.id); // Załóżmy, że interesuje nas identyfikator kafelka

        const selectedTilesParam = selectedTilesData.join(',');

        window.location.href = `/addReservation?selectedTiles=${selectedTilesParam}&date=${date}`;
    });


</script>
<script th:inline="javascript">
    // wyszukanie klienta w zarządzaniu
    function searchCustomers() {
        const searchValue = document.getElementById('searchInput').value;

        fetch(`/api/customer/search?lastName=${searchValue}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
                const tableBody = document.getElementById('customerTableBody');


                while (tableBody.firstChild) {
                    tableBody.removeChild(tableBody.firstChild);
                }

                if (data.length === 0) {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 4;
                    cell.textContent = 'Brak danych';
                } else {

                    data.forEach(customer => {
                        const row = tableBody.insertRow();
                        row.insertCell().textContent = customer.firstName;
                        row.insertCell().textContent = customer.lastName;
                        row.insertCell().textContent = customer.phone;
                        row.classList.add('text-center');

                        const editButton = document.createElement('a');
                        editButton.textContent = 'Edytuj';
                        editButton.classList.add('btn','btn-sm', 'btn-outline-warning','mx-1');
                        editButton.setAttribute('href',`/customer/showFormForUpdate?id=${customer.id}`);

                        const deleteButton = document.createElement('a');
                        deleteButton.textContent = 'Usuń';
                        deleteButton.classList.add('btn','btn-sm', 'btn-outline-danger','mx-1');
                        deleteButton.setAttribute('href',`/customer/delete?id=${customer.id}`)
                        deleteButton.setAttribute('onclick',"if (!(confirm('Czy na pewno chcesz usunąć tego klienta? Zostaną również usunięte jego rezerwacje'))) return false");

                        const actionCell = row.insertCell();
                        actionCell.appendChild(editButton);
                        actionCell.appendChild(deleteButton);
                    });
                }

            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });
    }



</script>

</body>
</html>



